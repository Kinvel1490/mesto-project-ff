(()=>{"use strict";function t(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function e(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function n(e){"Escape"==e.key&&t(document.querySelector(".popup_is-opened"))}var r={headers:{authorization:"5f80f61b-c737-4a1a-9ed2-65ea2c8c84f5","Content-Type":"application/json"},base:"https://nomoreparties.co/v1/wff-cohort-39"};function o(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(res.status))}var c=document.querySelector("#card-template").content.querySelector(".card");function a(t,e,n,r,o){var a=c.cloneNode(!0),i=a.querySelector(".card__like-button");a.id=t._id;var u=a.querySelector(".card__image");u.src=t.link,u.alt=t.name,a.querySelector(".card__title").innerText=t.name,a.querySelector(".card__like-count").innerText=t.likes.length;var l=a.querySelector(".card__delete-button");return o===t.owner._id?l.addEventListener("click",e):l.remove(),t.likes.forEach((function(t){t._id===o&&i.classList.add("card__like-button_is-active")})),i.addEventListener("click",n),u.addEventListener("click",r),a}function i(t){var e,n=t.target.closest(".card");(e=n.id,r.method="DELETE",fetch("".concat(r.base,"/cards/").concat(e),r).then((function(t){return o(t)}))).then((function(t){n.remove()})).catch((function(t){console.log(t)}))}function u(t){var e=t.target.classList.contains("card__like-button_is-active")?"delete":"put",n=t.target.closest(".card");(function(t,e){return r.method=t.toUpperCase(),fetch("".concat(r.base,"/cards/likes/").concat(e),r).then((function(t){return o(t)}))})(e,n.id).then((function(e){e&&(t.target.classList.toggle("card__like-button_is-active"),n.querySelector(".card__like-count").innerText=e.likes.length)})).catch((function(t){console.log(t)}))}function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function s(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return f(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){i=!0,c=t},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw c}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function d(t,e){if(t){var n=t.querySelectorAll(e.inputSelector);if(0!==n.length){if(n.length>0){var r,o=s(n);try{for(o.s();!(r=o.n()).done;)r.value.classList.remove(e.inputErrorClass)}catch(t){o.e(t)}finally{o.f()}}var c=t.querySelectorAll(".".concat(e.errorClass));if(c.length>0){var a,i=s(c);try{for(i.s();!(a=i.n()).done;)a.value.classList.remove(e.errorClass)}catch(t){i.e(t)}finally{i.f()}}var u=t.querySelectorAll(e.submitButtonSelector);if(u.length>0){var l,f=s(u);try{for(f.s();!(l=f.n()).done;)l.value.classList.add(e.inactiveButtonClass)}catch(t){f.e(t)}finally{f.f()}}}}}function p(t,e,n,r){var o=t.querySelector("#".concat(e.name,"-error"));o.classList.add(r.errorClass),t.querySelector('[name="'.concat(e.name,'"]')).classList.add(r.inputErrorClass),o.textContent=n}function m(t,e,n){t.querySelector("#".concat(e.name,"-error")).classList.remove(n.errorClass),t.querySelector('[name="'.concat(e.name,'"]')).classList.remove(n.inputErrorClass)}function v(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n):e.classList.add(n)}function y(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);v(n,r,e.inactiveButtonClass);var o,c=s(t.querySelectorAll(e.inputSelector));try{var a=function(){var c=o.value;c.addEventListener("input",(function(){!function(t,e,n){var r={errorClass:n.errorClass,inputErrorClass:n.inputErrorClass};"name"===e.name||"place-name"===e.name?/[^a-zа-яё^\s^-]/gi.test(e.value)?p(t,e,"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы",r):m(t,e,r):e.validity.valid?m(t,e,r):p(t,e,e.validationMessage,r)}(t,c,e),v(n,r,e.inactiveButtonClass)}))};for(c.s();!(o=c.n()).done;)a()}catch(t){c.e(t)}finally{c.f()}}var _=document.querySelector(".profile__edit-button"),b=document.querySelector(".places__list"),S=document.querySelector(".popup_type_edit"),h=document.querySelector(".profile__add-button"),g=document.querySelector(".popup_type_new-card"),C=document.querySelector(".popup_type_image"),q=C.querySelector(".popup__image"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),x=document.querySelector(".popup_type_avatar"),A=document.forms["edit-profile"],w=document.forms["new-place"],T=document.forms["new-avatar"],B=document.querySelector(".popup__caption"),j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},D="";function O(t){var n=t.target.alt||t.target.closest(".card").querySelector(".card__title").textContent;q.alt=n,B.textContent=n,(q.src=t.target.src)&&e(C)}Promise.all([fetch("".concat(r.base,"/users/me"),r).then((function(t){return o(t)})),fetch("".concat(r.base,"/cards"),r).then((function(t){return o(t)}))]).then((function(t){var e;t[0]&&(e=t[0],k.style.backgroundImage="url(".concat(e.avatar,")"),L.textContent=e.name,E.textContent=e.about,D=t[0]._id),t[1]&&t[1].forEach((function(e){b.append(a(e,i,u,O,t[0]._id))}))})).catch((function(t){console.log(t)})),_.addEventListener("click",(function(){e(S),A.name.value=L.textContent,A.description.value=E.textContent,A.name.dispatchEvent(new Event("input",{bubbles:!0})),A.description.dispatchEvent(new Event("input",{bubbles:!0}))})),h.addEventListener("click",(function(){e(g)})),k.addEventListener("click",(function(t){e(x),d(T,j),T.reset()})),document.addEventListener("click",(function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&t(e.target.closest(".popup"))})),A.addEventListener("submit",(function(e){e.preventDefault();var n,c,a=e.target.querySelector(".popup__button");a.textContent="Сохранение...",(n=A.name.value,c=A.description.value,r.method="PATCH",r.body=JSON.stringify({name:n,about:c}),fetch("".concat(r.base,"/users/me"),r).then((function(t){return o(t)}))).then((function(e){L.textContent=e.name,E.textContent=e.about,t(S),d(S.querySelector(".popup__form"),j)})).catch((function(t){console.log(t)})).finally((function(){a.textContent="Сохранить"}))})),w.addEventListener("submit",(function(e){e.preventDefault();var n={name:e.target["place-name"].value,link:e.target.link.value},c=e.target.querySelector('[type="submit"]');c.textContent="Сохранение...",function(t){return r.method="POST",r.body=JSON.stringify({name:t.name,link:t.link}),fetch("".concat(r.base,"/cards"),r).then((function(t){return o(t)}))}(n).then((function(e){e&&(b.prepend(a(e,i,u,O,D)),t(g),d(w,j),w.reset())})).catch((function(t){console.log(t)})).finally((function(){c.textContent="Сохранить"}))})),T.addEventListener("submit",(function(e){e.preventDefault();var n,c=e.target.querySelector('[type="submit"]');c.textContent="Сохранение...",(n=e.target.avatar_link.value,r.method="PATCH",r.body=JSON.stringify({avatar:n}),fetch("".concat(r.base,"/users/me/avatar"),r).then((function(t){return o(t)}))).then((function(e){e&&(k.style.backgroundImage="url(".concat(e.avatar,")"),t(x))})).catch((function(t){console.log(t)})).finally((function(){c.textContent="Сохранить"}))})),function(t){if(l("object"===(t=null!=t?t:{})&&!Array.isArray(t))&&0===Object.keys(t).length)return!1;var e,n=t.formSelector?".popup__form":t.formSelector,r=s(document.querySelectorAll(n));try{for(r.s();!(e=r.n()).done;){var o=e.value;o.addEventListener("submit",(function(t){t.preventDefault()})),y(o,t),d(o,t)}}catch(t){r.e(t)}finally{r.f()}document.addEventListener("click",(function(e){e.target.classList.contains(t.inactiveButtonClass)&&e.preventDefault()}))}(j)})();